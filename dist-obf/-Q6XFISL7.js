(function(_0x34812f,_0x59b6df){const _0x51c934=a0_0x1f92,_0x4f21fd=_0x34812f();while(!![]){try{const _0x1e9218=-parseInt(_0x51c934(0x1fa))/0x1+parseInt(_0x51c934(0x21b))/0x2*(parseInt(_0x51c934(0x1a5))/0x3)+-parseInt(_0x51c934(0x17b))/0x4+-parseInt(_0x51c934(0x1da))/0x5+parseInt(_0x51c934(0x178))/0x6+parseInt(_0x51c934(0x1f8))/0x7+parseInt(_0x51c934(0x180))/0x8;if(_0x1e9218===_0x59b6df)break;else _0x4f21fd['push'](_0x4f21fd['shift']());}catch(_0x566556){_0x4f21fd['push'](_0x4f21fd['shift']());}}}(a0_0x49c5,0xde63e));const a0_0x9ef048=(function(){let _0x26aa69=!![];return function(_0x309034,_0x206c38){const _0x625425=_0x26aa69?function(){const _0x26464d=a0_0x1f92;if(_0x206c38){const _0x4d4117=_0x206c38[_0x26464d(0x1df)](_0x309034,arguments);return _0x206c38=null,_0x4d4117;}}:function(){};return _0x26aa69=![],_0x625425;};}()),a0_0x3a9349=a0_0x9ef048(this,function(){const _0x40ad20=a0_0x1f92;return a0_0x3a9349[_0x40ad20(0x211)]()[_0x40ad20(0x1e0)](_0x40ad20(0x1f2))[_0x40ad20(0x211)]()[_0x40ad20(0x176)](a0_0x3a9349)[_0x40ad20(0x1e0)](_0x40ad20(0x1f2));});a0_0x3a9349();import'./chunk-6C3VEZWH.js';function a0_0x1f92(_0x380328,_0x361cc5){const _0x1c12ff=a0_0x49c5();return a0_0x1f92=function(_0x3a9349,_0x9ef048){_0x3a9349=_0x3a9349-0x16f;let _0x49c5e9=_0x1c12ff[_0x3a9349];return _0x49c5e9;},a0_0x1f92(_0x380328,_0x361cc5);}function expiryToISO(_0x3a7026,_0xb58151){const _0x2c148b=a0_0x1f92;if(!_0x3a7026||!_0xb58151)return null;const _0x42f2e2=_0xb58151[_0x2c148b(0x21a)](':')['length']===0x2?_0xb58151+':00':_0xb58151,_0x18601b=_0x3a7026+'T'+_0x42f2e2+'Z',_0x176b25=new Date(_0x18601b);if(isNaN(_0x176b25['getTime']()))return null;return _0x176b25[_0x2c148b(0x20c)]();}var _renderFuncs=null,_wasmFuncs=null,_hono=null;function a0_0x49c5(){const _0x4aed77=['SELECT\x20COUNT(DISTINCT\x20ip)\x20as\x20count\x20FROM\x20user_ips\x20WHERE\x20uuid\x20=\x20?','camera=(),\x20microphone=()','Static\x20assets\x20are\x20not\x20served\x20from\x20this\x20build.','send\x20ack\x20failed','set','57NJonVS','vless://','padStart','param','Host','example.com','</code></p>\x0a\x20\x20\x20\x20<p>Proxy:\x20','flush\x20on\x20close\x20failed','INSERT\x20OR\x20REPLACE\x20INTO\x20proxy_health\x20(ip_port,\x20is_healthy,\x20latency_ms,\x20last_check)\x20VALUES\x20(?,\x20?,\x20?,\x20?)','strict-origin-when-cross-origin','expiration_time','getUint8','round','ip_limit','from','text/plain;charset=utf-8','expiration_date','WASM\x20init\x20failed','/admin/logout','/admin/api/users/:uuid','message','X-Content-Type-Options','ADMIN_KEY','encode','formData','accept','SELECT\x20SUM(traffic_used)\x20as\x20sum\x20FROM\x20users','toLowerCase','abort','count','Unlimited','</a></p>\x0a\x20\x20\x20\x20<div\x20hx-get=\x22/api/user/','close','map','env','WASM\x20parse\x20failed,\x20falling\x20back\x20to\x20JS\x20parser','now','req','traffic_used',':443?type=ws&host=','user_ip\x20upsert\x20failed','push','https://','ensureTablesExist\x20failed','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20users\x20(\x0a\x20\x20\x20\x20\x20\x20uuid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20created_at\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20expiration_date\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20expiration_time\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20notes\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20traffic_limit\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20traffic_used\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20ip_limit\x20INTEGER\x20DEFAULT\x20-1\x0a\x20\x20\x20\x20)','waitUntil','/sb/:uuid','/:uuid','UPDATE\x20users\x20SET\x20expiration_date\x20=\x20?,\x20expiration_time\x20=\x20?,\x20notes\x20=\x20?,\x20traffic_limit\x20=\x20?,\x20ip_limit\x20=\x20?','/xray/:uuid','PROXYIPS','floor','/admin','8342065liUnDH','ip_port','warn','post','Invalid\x20UUID','apply','search','SELECT\x20token_hash\x20FROM\x20admin_session\x20WHERE\x20id\x20=\x20?','ip_limit\x20check\x20err','default','Internal\x20error','VLESS_WASM','Traffic\x20limit\x20exceeded','error','password','isAdminRequest\x20error','fetch','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20user_ips\x20(\x0a\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20ip\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20last_seen\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(uuid,\x20ip)\x0a\x20\x20\x20\x20)','renderUserPanel','text/html;charset=utf-8','data','/admin/api/users','signal','flushUsage\x20outer','(((.+)+)+)+$','</p>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a\x20\x20</body></html>','subtle',',\x20traffic_used\x20=\x200','values','wasm\x20init\x20skipped','224014oRldpi','first','300187TnMQUt','substring','digest','executionCtx','/api/user/:uuid/stats','buffer','DELETE\x20FROM\x20admin_session\x20WHERE\x20id\x20=\x20?','message\x20handler\x20error','cookie','match','Referrer-Policy','UPDATE\x20users\x20SET\x20traffic_used\x20=\x20traffic_used\x20+\x20?\x20WHERE\x20uuid\x20=\x20?','IP\x20limit\x20exceeded','test','renderAdminLogin','/ws','&path=/ws#singbox','WebSocketPair','toISOString','DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?','auth_token=','string','traffic_limit','toString','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20proxy_health\x20(\x0a\x20\x20\x20\x20\x20\x20ip_port\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20is_healthy\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20latency_ms\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20last_check\x20INTEGER\x0a\x20\x20\x20\x20)','/admin/api/health-check','uuid','/sb/','admin\x20session\x20store\x20failed','run','randomUUID','auth_token=;\x20Max-Age=0;\x20Path=/;\x20Secure;\x20HttpOnly;\x20SameSite=Strict','split','84130eLrooM','SELECT\x20traffic_used,\x20traffic_limit,\x20expiration_date,\x20expiration_time\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?','text','send','INSERT\x20INTO\x20users\x20(uuid,\x20expiration_date,\x20expiration_time,\x20notes,\x20traffic_limit,\x20ip_limit,\x20traffic_used)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x200)','SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?','all',';\x20HttpOnly;\x20Secure;\x20Path=/;\x20Max-Age=86400;\x20SameSite=Strict','nosniff','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20admin_session\x20(\x0a\x20\x20\x20\x20\x20\x20id\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20token_hash\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20created_at\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20expires_at\x20INTEGER\x0a\x20\x20\x20\x20)','constructor','&path=/ws#xray','7882224lThxPN','INSERT\x20OR\x20REPLACE\x20INTO\x20user_ips\x20(uuid,\x20ip,\x20last_seen)\x20VALUES\x20(?,\x20?,\x20CURRENT_TIMESTAMP)','CF-Connecting-IP','6573808xftxxI','Must\x20upgrade\x20to\x20WebSocket','SELECT\x20uuid,\x20created_at,\x20expiration_date,\x20expiration_time,\x20notes,\x20traffic_limit,\x20traffic_used,\x20ip_limit\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC','/admin/api/stats','join','19024168xiFejn','SELECT\x20uuid,\x20traffic_limit,\x20traffic_used,\x20expiration_date,\x20expiration_time,\x20ip_limit\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?','trim','/login','byteLength','headers','get','<!doctype\x20html><html><head><meta\x20charset=\x22utf-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,initial-scale=1\x22><title>User\x20Panel</title><script\x20src=\x22https://unpkg.com/htmx.org@1.9.2\x22></script><script\x20src=\x22https://unpkg.com/alpinejs@3.x.x\x22\x20defer></script></head><body>\x0a\x20\x20<h1>User\x20Panel</h1>\x0a\x20\x20<div>\x0a\x20\x20\x20\x20<p>UUID:\x20<code>','addEventListener','delete','initial\x20header\x20parse\x20error','sum','stringify','INSERT\x20OR\x20REPLACE\x20INTO\x20admin_session\x20(id,\x20token_hash,\x20expires_at)\x20VALUES\x20(?,\x20?,\x20?)','443','SHA-256','Permissions-Policy','renderAdminPanel','/stats\x22\x20hx-trigger=\x22every\x205s\x22\x20hx-swap=\x22outerHTML\x22\x20id=\x22stats-area\x22>\x0a\x20\x20\x20\x20\x20\x20<p>Data\x20used:\x20','arrayBuffer','batch','Forbidden','bind','upgrade','put','prepare','Set-Cookie','./userView-UXVA5P2I.js','json','./adminView-PDCS76LA.js','Missing\x20fields','\x20WHERE\x20uuid\x20=\x20?'];a0_0x49c5=function(){return _0x4aed77;};return a0_0x49c5();}async function getHono(){return!_hono&&(_hono=await import('./dist-EJVHA5IP.js')),_hono;}async function getRenderFuncs(){const _0x17dd1d=a0_0x1f92;if(!_renderFuncs){const _0x520225=await import(_0x17dd1d(0x19d)),_0x53a309=await import(_0x17dd1d(0x19b));_renderFuncs={'renderAdminLogin':_0x520225[_0x17dd1d(0x208)],'renderAdminPanel':_0x520225[_0x17dd1d(0x191)],'renderUserPanel':_0x53a309[_0x17dd1d(0x1ec)]};}return _renderFuncs;}async function getWasmFuncs(){return!_wasmFuncs&&(_wasmFuncs=await import('./wasm-LZBCYNKY.js')),_wasmFuncs;}var appInstance=null,initPromise=null,tablesInitialized=![];async function initializeApp(){if(initPromise)return initPromise;if(appInstance)return;return initPromise=((async()=>{if(!appInstance){const {Hono:_0x57fc25}=await getHono();appInstance=new _0x57fc25(),await registerRoutes(appInstance);}})()),initPromise;}async function ensureTablesInitialized(_0x12e08c){if(tablesInitialized||!_0x12e08c['DB'])return;tablesInitialized=!![],await ensureTablesExist(_0x12e08c);}async function registerRoutes(_0x31b062){const _0x1af84b=a0_0x1f92;function _0x167e17(_0x5f57b4){const _0x3fcf2d=a0_0x1f92;_0x5f57b4[_0x3fcf2d(0x1a4)](_0x3fcf2d(0x1ba),_0x3fcf2d(0x174)),_0x5f57b4['set'](_0x3fcf2d(0x204),_0x3fcf2d(0x1ae)),_0x5f57b4[_0x3fcf2d(0x1a4)](_0x3fcf2d(0x190),_0x3fcf2d(0x1a1));}_0x31b062[_0x1af84b(0x1dd)]('/admin/login',async _0x314c5d=>{const _0x3ec913=_0x1af84b,_0x10cd1e=_0x314c5d[_0x3ec913(0x1c7)],_0x15e5bd=await _0x314c5d[_0x3ec913(0x1ca)][_0x3ec913(0x1bd)](),_0x4bf07b=_0x15e5bd[_0x3ec913(0x186)](_0x3ec913(0x1e8))?.['toString']()||'';if(!_0x10cd1e[_0x3ec913(0x1bb)])return _0x314c5d[_0x3ec913(0x21d)]('Admin\x20not\x20configured',0x1f7);if(_0x4bf07b!==_0x10cd1e[_0x3ec913(0x1bb)])return _0x314c5d['text']('Invalid',0x191);const _0x4cc02b=crypto[_0x3ec913(0x218)](),_0x22b8dd=await crypto[_0x3ec913(0x1f4)][_0x3ec913(0x1fc)](_0x3ec913(0x18f),new TextEncoder()[_0x3ec913(0x1bc)](_0x4cc02b)),_0x5efd8d=Array[_0x3ec913(0x1b3)](new Uint8Array(_0x22b8dd))[_0x3ec913(0x1c6)](_0x1fea4e=>_0x1fea4e[_0x3ec913(0x211)](0x10)[_0x3ec913(0x1a7)](0x2,'0'))[_0x3ec913(0x17f)]('');try{await _0x10cd1e['DB'][_0x3ec913(0x199)](_0x3ec913(0x18d))[_0x3ec913(0x196)]('default',_0x5efd8d,Math[_0x3ec913(0x1d8)](Date[_0x3ec913(0x1c9)]()/0x3e8)+0x15180)['run']();}catch(_0x134cb4){console[_0x3ec913(0x1e7)](_0x3ec913(0x216),_0x134cb4);}const _0xaccb79=new Headers();return _0xaccb79['append'](_0x3ec913(0x19a),_0x3ec913(0x20e)+_0x4cc02b+_0x3ec913(0x173)),_0x167e17(_0xaccb79),_0x314c5d[_0x3ec913(0x21d)]('OK',0xc8,{'headers':_0xaccb79});});async function _0x463c89(_0x3ce99f){const _0x130eeb=_0x1af84b,_0x12f6d1=new TextEncoder(),_0x2e7827=_0x12f6d1[_0x130eeb(0x1bc)](_0x3ce99f),_0x272221=await crypto[_0x130eeb(0x1f4)][_0x130eeb(0x1fc)](_0x130eeb(0x18f),_0x2e7827);return Array['from'](new Uint8Array(_0x272221))[_0x130eeb(0x1c6)](_0x16d86c=>_0x16d86c['toString'](0x10)[_0x130eeb(0x1a7)](0x2,'0'))[_0x130eeb(0x17f)]('');}async function _0xe8d0d8(_0x271236){const _0x1b0fc8=_0x1af84b,_0x35fe42=_0x271236[_0x1b0fc8(0x1ca)][_0x1b0fc8(0x185)][_0x1b0fc8(0x186)](_0x1b0fc8(0x202))||'',_0x1e93e2=_0x35fe42[_0x1b0fc8(0x203)](/auth_token=([^;]+)/)?.[0x1];if(!_0x1e93e2)return![];const _0x11db56=await _0x463c89(_0x1e93e2);try{const _0x49a5cc=await _0x271236[_0x1b0fc8(0x1c7)]['DB'][_0x1b0fc8(0x199)](_0x1b0fc8(0x1e1))[_0x1b0fc8(0x196)](_0x1b0fc8(0x1e3))[_0x1b0fc8(0x1f9)]();if(!_0x49a5cc?.['token_hash'])return![];return _0x11db56===_0x49a5cc['token_hash'];}catch(_0x4bdbe1){return console[_0x1b0fc8(0x1dc)](_0x1b0fc8(0x1e9),_0x4bdbe1),![];}}async function _0x78580f(_0x5c4468){const _0x175e08=_0x1af84b;if(!_0x5c4468['DB'])return;const _0x229b08=[_0x175e08(0x1d1),_0x175e08(0x1eb),_0x175e08(0x212),_0x175e08(0x175)];try{const _0x5f0c96=_0x229b08[_0x175e08(0x1c6)](_0x443550=>_0x5c4468['DB'][_0x175e08(0x199)](_0x443550));await _0x5c4468['DB'][_0x175e08(0x194)](_0x5f0c96);}catch(_0x9cc964){console[_0x175e08(0x1dc)](_0x175e08(0x1d0),_0x9cc964);}}_0x31b062[_0x1af84b(0x186)](_0x1af84b(0x1d9),async _0x87c2a4=>{const _0x13cf11=_0x1af84b;await ensureTablesInitialized(_0x87c2a4[_0x13cf11(0x1c7)]);const _0x1f76a6=await _0xe8d0d8(_0x87c2a4),_0x1b4230=_0x13cf11(0x1d9),_0x113e5a=new Headers({'Content-Type':_0x13cf11(0x1ed)});_0x167e17(_0x113e5a);if(!_0x1f76a6){const {renderAdminLogin:_0x446905}=await getRenderFuncs();return new Response(_0x446905(_0x1b4230+_0x13cf11(0x183)),{'headers':_0x113e5a});}const {renderAdminPanel:_0x2fd8e4}=await getRenderFuncs();return new Response(_0x2fd8e4(),{'headers':_0x113e5a});}),_0x31b062[_0x1af84b(0x186)](_0x1af84b(0x17e),async _0x5123dd=>{const _0x599801=_0x1af84b;if(!await _0xe8d0d8(_0x5123dd))return _0x5123dd[_0x599801(0x19c)]({'error':_0x599801(0x195)},0x193);const _0x1f008d=_0x5123dd['env'];await ensureTablesInitialized(_0x1f008d);try{const _0x2d4dfb=await _0x1f008d['DB'][_0x599801(0x199)]('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20users')[_0x599801(0x1f9)]('count'),_0x42b93c=await _0x1f008d['DB'][_0x599801(0x199)]('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20users\x20WHERE\x20datetime(expiration_date\x20||\x20\x27T\x27\x20||\x20expiration_time\x20||\x20\x27Z\x27)\x20<\x20datetime(\x27now\x27)')[_0x599801(0x1f9)](_0x599801(0x1c2)),_0x4d63e3=await _0x1f008d['DB'][_0x599801(0x199)](_0x599801(0x1bf))['first'](_0x599801(0x18b)),_0x2819e7=_0x42b93c||0x0,_0x3e6c67=(_0x2d4dfb||0x0)-_0x2819e7;return _0x5123dd['json']({'total_users':_0x2d4dfb||0x0,'active_users':_0x3e6c67,'expired_users':_0x2819e7,'total_traffic':_0x4d63e3||0x0});}catch(_0x320f16){const _0x1acdbb=_0x320f16 instanceof Error?_0x320f16[_0x599801(0x1b9)]:String(_0x320f16);return _0x5123dd[_0x599801(0x19c)]({'error':_0x1acdbb},0x1f4);}}),_0x31b062[_0x1af84b(0x186)](_0x1af84b(0x1ef),async _0x5a341f=>{const _0x21f298=_0x1af84b;if(!await _0xe8d0d8(_0x5a341f))return _0x5a341f['json']({'error':_0x21f298(0x195)},0x193);const _0x4b9fc5=await _0x5a341f['env']['DB'][_0x21f298(0x199)](_0x21f298(0x17d))[_0x21f298(0x172)]();return _0x5a341f[_0x21f298(0x19c)](_0x4b9fc5['results']||[]);}),_0x31b062[_0x1af84b(0x1dd)]('/admin/api/users',async _0x45bc4e=>{const _0x47f805=_0x1af84b;if(!await _0xe8d0d8(_0x45bc4e))return _0x45bc4e[_0x47f805(0x19c)]({'error':'Forbidden'},0x193);const _0x5a4faa=await _0x45bc4e[_0x47f805(0x1ca)][_0x47f805(0x19c)](),{uuid:_0x3f371f,exp_date:_0x311991,exp_time:_0x337ad3,notes:_0x4e3a6e,traffic_limit:_0x4537fc,ip_limit:_0x17cbad}=_0x5a4faa;if(!_0x3f371f||!_0x311991||!_0x337ad3)return _0x45bc4e[_0x47f805(0x19c)]({'error':_0x47f805(0x19e)},0x190);try{return await _0x45bc4e[_0x47f805(0x1c7)]['DB']['prepare'](_0x47f805(0x170))[_0x47f805(0x196)](_0x3f371f,_0x311991,_0x337ad3,_0x4e3a6e||null,_0x4537fc||null,_0x17cbad||-0x1)[_0x47f805(0x217)](),_0x45bc4e['json']({'success':!![],'uuid':_0x3f371f},0xc9);}catch(_0xa5eee1){const _0x54b8a8=_0xa5eee1 instanceof Error?_0xa5eee1[_0x47f805(0x1b9)]:String(_0xa5eee1);return _0x45bc4e[_0x47f805(0x19c)]({'error':_0x54b8a8},0x190);}}),_0x31b062[_0x1af84b(0x198)](_0x1af84b(0x1b8),async _0x2c0aa7=>{const _0x52ee45=_0x1af84b;if(!await _0xe8d0d8(_0x2c0aa7))return _0x2c0aa7['json']({'error':_0x52ee45(0x195)},0x193);const _0x17d4df=_0x2c0aa7['req'][_0x52ee45(0x1a8)]('uuid'),_0xa0a35a=await _0x2c0aa7[_0x52ee45(0x1ca)][_0x52ee45(0x19c)](),{exp_date:_0x1bf8a6,exp_time:_0x1ec546,notes:_0xb4fbc0,traffic_limit:_0x58a2ab,ip_limit:_0x8e64f8,reset_traffic:_0x24e83f}=_0xa0a35a;if(!_0x1bf8a6||!_0x1ec546)return _0x2c0aa7['json']({'error':'Missing\x20date/time'},0x190);try{let _0x5e3a93=_0x52ee45(0x1d5);if(_0x24e83f)_0x5e3a93+=_0x52ee45(0x1f5);return _0x5e3a93+=_0x52ee45(0x19f),await _0x2c0aa7[_0x52ee45(0x1c7)]['DB'][_0x52ee45(0x199)](_0x5e3a93)[_0x52ee45(0x196)](_0x1bf8a6,_0x1ec546,_0xb4fbc0||null,_0x58a2ab||null,_0x8e64f8||-0x1,_0x17d4df)['run'](),_0x2c0aa7[_0x52ee45(0x19c)]({'success':!![],'uuid':_0x17d4df});}catch(_0x5d9400){const _0x3984dc=_0x5d9400 instanceof Error?_0x5d9400[_0x52ee45(0x1b9)]:String(_0x5d9400);return _0x2c0aa7[_0x52ee45(0x19c)]({'error':_0x3984dc},0x190);}}),_0x31b062[_0x1af84b(0x189)](_0x1af84b(0x1b8),async _0x2b31aa=>{const _0x103c82=_0x1af84b;if(!await _0xe8d0d8(_0x2b31aa))return _0x2b31aa[_0x103c82(0x19c)]({'error':'Forbidden'},0x193);const _0x225450=_0x2b31aa[_0x103c82(0x1ca)]['param'](_0x103c82(0x214));try{return await _0x2b31aa[_0x103c82(0x1c7)]['DB']['prepare'](_0x103c82(0x20d))[_0x103c82(0x196)](_0x225450)[_0x103c82(0x217)](),_0x2b31aa['json']({'success':!![],'uuid':_0x225450});}catch(_0xfc82ca){const _0x2f07a3=_0xfc82ca instanceof Error?_0xfc82ca[_0x103c82(0x1b9)]:String(_0xfc82ca);return _0x2b31aa['json']({'error':_0x2f07a3},0x1f4);}}),_0x31b062[_0x1af84b(0x1dd)](_0x1af84b(0x213),async _0x2f9e80=>{const _0xd77bfe=_0x1af84b;if(!await _0xe8d0d8(_0x2f9e80))return _0x2f9e80[_0xd77bfe(0x19c)]({'error':'Forbidden'},0x193);const _0x2c6269=_0x2f9e80[_0xd77bfe(0x1c7)],_0x229ce3=_0x2c6269['PROXYIPS']?_0x2c6269['PROXYIPS'][_0xd77bfe(0x21a)](',')[_0xd77bfe(0x1c6)](_0x556c7b=>_0x556c7b[_0xd77bfe(0x182)]()):['speed.cloudflare.com:443'],_0x212fc4=[];for(const _0x501db1 of _0x229ce3){const [_0x11a7b3,_0xdc5d22=_0xd77bfe(0x18e)]=_0x501db1[_0xd77bfe(0x21a)](':');let _0x9aafe8=null,_0x3f8a56=0x0;const _0xac44ce=Date[_0xd77bfe(0x1c9)]();try{const _0x1b84bc=new AbortController(),_0xbeb3dc=setTimeout(()=>_0x1b84bc[_0xd77bfe(0x1c1)](),0x1388),_0x345d27=await fetch(_0xd77bfe(0x1cf)+_0x11a7b3+':'+_0xdc5d22,{'signal':_0x1b84bc[_0xd77bfe(0x1f0)]});clearTimeout(_0xbeb3dc),_0x345d27['ok']&&(_0x9aafe8=Date[_0xd77bfe(0x1c9)]()-_0xac44ce,_0x3f8a56=0x1);}catch(_0x1eb93f){}_0x212fc4[_0xd77bfe(0x1ce)](_0x2c6269['DB']['prepare'](_0xd77bfe(0x1ad))['bind'](_0x501db1,_0x3f8a56,_0x9aafe8,Math[_0xd77bfe(0x1d8)](Date[_0xd77bfe(0x1c9)]()/0x3e8)));}try{return await _0x2c6269['DB'][_0xd77bfe(0x194)](_0x212fc4),_0x2f9e80[_0xd77bfe(0x19c)]({'success':!![]});}catch(_0x149855){return _0x2f9e80[_0xd77bfe(0x19c)]({'error':_0x149855?.[_0xd77bfe(0x1b9)]||String(_0x149855)},0x1f4);}}),_0x31b062[_0x1af84b(0x1dd)](_0x1af84b(0x1b7),async _0x59758a=>{const _0x36662f=_0x1af84b;try{await _0x59758a[_0x36662f(0x1c7)]['DB'][_0x36662f(0x199)](_0x36662f(0x200))['bind']('default')[_0x36662f(0x217)]();}catch(_0x568d93){}const _0x49467c=new Headers();return _0x49467c['append'](_0x36662f(0x19a),_0x36662f(0x219)),_0x167e17(_0x49467c),new Response(JSON[_0x36662f(0x18c)]({'success':!![]}),{'headers':_0x49467c});}),_0x31b062[_0x1af84b(0x186)](_0x1af84b(0x1fe),async _0x56174d=>{const _0x5e4674=_0x1af84b,{uuid:_0xbb50a5}=_0x56174d[_0x5e4674(0x1ca)][_0x5e4674(0x1a8)](),_0x55ffd0=_0x56174d[_0x5e4674(0x1c7)];if(!/^[0-9a-fA-F-]{36}$/[_0x5e4674(0x207)](_0xbb50a5))return _0x56174d[_0x5e4674(0x19c)]({'error':'invalid'},0x190);const _0x46de94=await _0x55ffd0['DB'][_0x5e4674(0x199)](_0x5e4674(0x21c))[_0x5e4674(0x196)](_0xbb50a5)[_0x5e4674(0x1f9)]();if(!_0x46de94)return _0x56174d[_0x5e4674(0x19c)]({'error':'not\x20found'},0x194);const _0x63ae8d=expiryToISO(_0x46de94[_0x5e4674(0x1b5)],_0x46de94['expiration_time']);return _0x56174d['json']({'traffic_used':_0x46de94[_0x5e4674(0x1cb)]||0x0,'traffic_limit':_0x46de94[_0x5e4674(0x210)]||null,'expiration_iso':_0x63ae8d});}),_0x31b062[_0x1af84b(0x186)](_0x1af84b(0x1d4),async _0x252282=>{const _0x505edd=_0x1af84b,_0x271601=_0x252282[_0x505edd(0x1ca)][_0x505edd(0x1a8)](_0x505edd(0x214)),_0x3e3d77=_0x252282[_0x505edd(0x1c7)];if(!/^[0-9a-fA-F-]{36}$/['test'](_0x271601))return _0x252282[_0x505edd(0x21d)](_0x505edd(0x1de),0x190);const _0x2017d8=await _0x3e3d77['DB'][_0x505edd(0x199)](_0x505edd(0x171))[_0x505edd(0x196)](_0x271601)[_0x505edd(0x1f9)]();if(!_0x2017d8)return _0x252282['text']('Authentication\x20failed',0x193);let _0x1a0f01=_0x3e3d77[_0x505edd(0x1d7)]?_0x3e3d77[_0x505edd(0x1d7)][_0x505edd(0x21a)](',')[0x0]:'speed.cloudflare.com:443';try{const _0x4fb26f=await _0x3e3d77['DB'][_0x505edd(0x199)]('SELECT\x20ip_port\x20FROM\x20proxy_health\x20WHERE\x20is_healthy\x20=\x201\x20ORDER\x20BY\x20latency_ms\x20ASC\x20LIMIT\x201')[_0x505edd(0x1f9)]();if(_0x4fb26f?.[_0x505edd(0x1db)])_0x1a0f01=_0x4fb26f[_0x505edd(0x1db)];}catch(_0x58ded1){}const _0x198b05=_0x252282['req']['headers'][_0x505edd(0x186)](_0x505edd(0x1a9))||'example.com',_0x4ce83f='https://'+_0x198b05+'/xray/'+_0x271601,_0x5a9ba5=_0x505edd(0x1cf)+_0x198b05+_0x505edd(0x215)+_0x271601,_0x1fbd51=expiryToISO(_0x2017d8[_0x505edd(0x1b5)],_0x2017d8[_0x505edd(0x1af)]),_0x3a9569=_0x505edd(0x187)+_0x271601+_0x505edd(0x1ab)+_0x1a0f01+'</p>\x0a\x20\x20\x20\x20<p>Subscription\x20(Xray):\x20<a\x20href=\x22'+_0x4ce83f+'\x22>'+_0x4ce83f+'</a></p>\x0a\x20\x20\x20\x20<p>Subscription\x20(Singbox):\x20<a\x20href=\x22'+_0x5a9ba5+'\x22>'+_0x5a9ba5+_0x505edd(0x1c4)+_0x271601+_0x505edd(0x192)+(_0x2017d8['traffic_used']||0x0)+'\x20Bytes</p>\x0a\x20\x20\x20\x20\x20\x20<p>Expiry\x20(UTC):\x20'+(_0x1fbd51||_0x505edd(0x1c3))+_0x505edd(0x1f3),_0x1481d1=new Headers({'Content-Type':_0x505edd(0x1ed)});return _0x167e17(_0x1481d1),new Response(_0x3a9569,{'headers':_0x1481d1});}),_0x31b062[_0x1af84b(0x186)](_0x1af84b(0x1d6),async _0x415621=>{const _0x3d376d=_0x1af84b,_0x40528f=_0x415621[_0x3d376d(0x1ca)][_0x3d376d(0x1a8)](_0x3d376d(0x214));if(!/^[0-9a-fA-F-]{36}$/['test'](_0x40528f))return _0x415621[_0x3d376d(0x21d)](_0x3d376d(0x1de),0x190);const _0x24b689=_0x415621[_0x3d376d(0x1ca)][_0x3d376d(0x185)][_0x3d376d(0x186)](_0x3d376d(0x1a9))||_0x3d376d(0x1aa),_0x97c2a6=[_0x3d376d(0x1a6)+_0x40528f+'@'+_0x24b689+_0x3d376d(0x1cc)+_0x24b689+_0x3d376d(0x177)],_0x165a17=new Headers({'Content-Type':_0x3d376d(0x1b4)});return _0x167e17(_0x165a17),new Response(btoa(_0x97c2a6['join']('\x0a')),{'headers':_0x165a17});}),_0x31b062[_0x1af84b(0x186)](_0x1af84b(0x1d3),async _0xa663c5=>{const _0x111bce=_0x1af84b,_0x28caca=_0xa663c5[_0x111bce(0x1ca)][_0x111bce(0x1a8)]('uuid');if(!/^[0-9a-fA-F-]{36}$/[_0x111bce(0x207)](_0x28caca))return _0xa663c5['text'](_0x111bce(0x1de),0x190);const _0x296826=_0xa663c5[_0x111bce(0x1ca)][_0x111bce(0x185)][_0x111bce(0x186)]('Host')||_0x111bce(0x1aa),_0x3d92ac=[_0x111bce(0x1a6)+_0x28caca+'@'+_0x296826+':443?type=ws&host='+_0x296826+_0x111bce(0x20a)],_0x3a8db6=new Headers({'Content-Type':_0x111bce(0x1b4)});return _0x167e17(_0x3a8db6),new Response(btoa(_0x3d92ac['join']('\x0a')),{'headers':_0x3a8db6});}),_0x31b062['all'](_0x1af84b(0x209),async _0x4ffcfd=>{const _0x1abd03=_0x1af84b,_0x211fc8=_0x4ffcfd[_0x1abd03(0x1ca)],_0x46fda9=_0x4ffcfd[_0x1abd03(0x1c7)];if(_0x211fc8[_0x1abd03(0x185)][_0x1abd03(0x186)](_0x1abd03(0x197))?.[_0x1abd03(0x1c0)]()!=='websocket')return _0x4ffcfd[_0x1abd03(0x21d)](_0x1abd03(0x17c),0x190);try{if(_0x46fda9[_0x1abd03(0x1e5)])try{const {initWasm:_0x152996}=await getWasmFuncs();await _0x152996();}catch(_0x224188){console[_0x1abd03(0x1dc)](_0x1abd03(0x1b6),_0x224188);}}catch(_0x8cc50f){console[_0x1abd03(0x1dc)](_0x1abd03(0x1f7),_0x8cc50f);}const _0x2b64c2=new globalThis[(_0x1abd03(0x20b))](),[_0x2c6213,_0x2640e0]=Object[_0x1abd03(0x1f6)](_0x2b64c2);_0x2640e0[_0x1abd03(0x1be)]();let _0x30b400=0x0,_0x13b49e='';const _0x3e2771=async()=>{const _0x455a80=_0x1abd03;try{if(!_0x13b49e||_0x30b400<=0x0)return;_0x4ffcfd[_0x455a80(0x1fd)]['waitUntil'](((async()=>{const _0x187e23=_0x455a80;try{await _0x46fda9['DB'][_0x187e23(0x199)](_0x187e23(0x205))[_0x187e23(0x196)](Math[_0x187e23(0x1b1)](_0x30b400),_0x13b49e)[_0x187e23(0x217)]();}catch(_0x2d4c17){console[_0x187e23(0x1e7)]('flush\x20usage\x20error',_0x2d4c17);}})())),_0x30b400=0x0;}catch(_0x3daaaa){console[_0x455a80(0x1e7)](_0x455a80(0x1f1),_0x3daaaa);}},_0x14f691=setInterval(()=>{_0x3e2771();},0x2710);_0x2640e0[_0x1abd03(0x188)](_0x1abd03(0x1b9),async _0xd73a0f=>{const _0x4fc53d=_0x1abd03;try{const _0x19ebfa=_0xd73a0f[_0x4fc53d(0x1ee)];let _0x3891b1;if(typeof _0x19ebfa===_0x4fc53d(0x20f))_0x3891b1=new TextEncoder()[_0x4fc53d(0x1bc)](_0x19ebfa);else{if(_0x19ebfa instanceof ArrayBuffer)_0x3891b1=new Uint8Array(_0x19ebfa);else{if(_0x19ebfa instanceof Blob)_0x3891b1=new Uint8Array(await _0x19ebfa[_0x4fc53d(0x193)]());else return;}}_0x30b400+=_0x3891b1['byteLength'];if(!_0x13b49e)try{if(_0x3891b1[_0x4fc53d(0x184)]<0x18){}let _0x50efd8=null;try{const {parseVlessHeader:_0x561985}=await getWasmFuncs();_0x50efd8=await _0x561985(_0x3891b1);}catch(_0x1943f5){console['warn'](_0x4fc53d(0x1c8),_0x1943f5);}if(!_0x50efd8){const _0x263b3d=new DataView(_0x3891b1[_0x4fc53d(0x1ff)]),_0x5db8d0=new Uint8Array(_0x3891b1[_0x4fc53d(0x1ff)]['slice'](0x1,0x11)),_0x429156=Array[_0x4fc53d(0x1b3)](_0x5db8d0)[_0x4fc53d(0x1c6)](_0x10151f=>_0x10151f['toString'](0x10)['padStart'](0x2,'0'))[_0x4fc53d(0x17f)](''),_0x58090c=_0x429156[_0x4fc53d(0x1fb)](0x0,0x8)+'-'+_0x429156[_0x4fc53d(0x1fb)](0x8,0xc)+'-'+_0x429156['substring'](0xc,0x10)+'-'+_0x429156[_0x4fc53d(0x1fb)](0x10,0x14)+'-'+_0x429156['substring'](0x14,0x20);_0x50efd8={'uuid':_0x58090c,'command':_0x263b3d[_0x4fc53d(0x1b0)](0x12),'address':'','address_type':0x1,'port':0x1bb};}_0x13b49e=_0x50efd8[_0x4fc53d(0x214)];const _0x171cf8=await _0x46fda9['DB'][_0x4fc53d(0x199)](_0x4fc53d(0x181))[_0x4fc53d(0x196)](_0x13b49e)[_0x4fc53d(0x1f9)]();if(!_0x171cf8){_0x2640e0[_0x4fc53d(0x1c5)](0x3f3,'Authentication\x20failed');return;}const _0x467b0f=expiryToISO(_0x171cf8[_0x4fc53d(0x1b5)],_0x171cf8[_0x4fc53d(0x1af)]);if(_0x467b0f&&new Date(_0x467b0f)<=new Date()){_0x2640e0[_0x4fc53d(0x1c5)](0x3f0,'Expired');return;}if(_0x171cf8[_0x4fc53d(0x210)]&&_0x171cf8[_0x4fc53d(0x210)]>0x0&&(_0x171cf8['traffic_used']||0x0)>=_0x171cf8[_0x4fc53d(0x210)]){_0x2640e0[_0x4fc53d(0x1c5)](0x3f0,_0x4fc53d(0x1e6));return;}try{const _0x3955b3=_0x211fc8[_0x4fc53d(0x185)][_0x4fc53d(0x186)](_0x4fc53d(0x17a))||_0x211fc8[_0x4fc53d(0x185)][_0x4fc53d(0x186)]('x-forwarded-for')||'';if(_0x171cf8[_0x4fc53d(0x1b2)]&&_0x171cf8[_0x4fc53d(0x1b2)]>-0x1){const _0x5af137=await _0x46fda9['DB'][_0x4fc53d(0x199)](_0x4fc53d(0x1a0))[_0x4fc53d(0x196)](_0x13b49e)[_0x4fc53d(0x1f9)](),_0x475c5c=_0x5af137?.[_0x4fc53d(0x1c2)]||0x0;if(_0x475c5c>=_0x171cf8['ip_limit']){_0x2640e0[_0x4fc53d(0x1c5)](0x3f0,_0x4fc53d(0x206));return;}}_0x4ffcfd[_0x4fc53d(0x1fd)][_0x4fc53d(0x1d2)](((async()=>{const _0x46a908=_0x4fc53d;try{await _0x46fda9['DB'][_0x46a908(0x199)](_0x46a908(0x179))['bind'](_0x13b49e,_0x211fc8[_0x46a908(0x185)][_0x46a908(0x186)](_0x46a908(0x17a))||'unknown')[_0x46a908(0x217)]();}catch(_0x19269c){console[_0x46a908(0x1dc)](_0x46a908(0x1cd),_0x19269c);}})()));}catch(_0x4f4a02){console['warn'](_0x4fc53d(0x1e2),_0x4f4a02);}}catch(_0x1f094e){console['error'](_0x4fc53d(0x18a),_0x1f094e),_0x2640e0[_0x4fc53d(0x1c5)](0x3f3,'Parse\x20error');return;}try{_0x2640e0['readyState']===0x1&&_0x2640e0[_0x4fc53d(0x16f)]('ACK');}catch(_0x860b0c){console[_0x4fc53d(0x1dc)](_0x4fc53d(0x1a3),_0x860b0c);}}catch(_0x1984ac){console[_0x4fc53d(0x1e7)](_0x4fc53d(0x201),_0x1984ac);try{_0x2640e0[_0x4fc53d(0x1c5)](0x3f3,_0x4fc53d(0x1e4));}catch(_0x439fea){}}}),_0x2640e0[_0x1abd03(0x188)]('close',async()=>{const _0xa4b688=_0x1abd03;clearInterval(_0x14f691);try{await _0x3e2771();}catch(_0x1d52ee){console[_0xa4b688(0x1dc)](_0xa4b688(0x1ac),_0x1d52ee);}});const _0x225146=new Headers();_0x167e17(_0x225146);const _0x1a2e3c={'status':0x65,'webSocket':_0x2c6213,'headers':_0x225146};return new Response(null,_0x1a2e3c);}),_0x31b062[_0x1af84b(0x186)]('/static/*',async _0x43f6fb=>{const _0x5b5fb9=_0x1af84b;return _0x43f6fb[_0x5b5fb9(0x21d)](_0x5b5fb9(0x1a2));});}var src_default={'fetch':async(_0x31426e,_0x3edce9,_0x4dc873)=>{const _0xf0a73e=a0_0x1f92;return await initializeApp(),appInstance[_0xf0a73e(0x1ea)](_0x31426e,_0x3edce9,_0x4dc873);}};export{src_default as default,expiryToISO};