const a0j=(function(){let h=!![];return function(j,c){const C=h?function(){if(c){const G=c['apply'](j,arguments);c=null;return G;}}:function(){};h=![];return C;};}());const a0h=a0j(this,function(){const W=a0C;return a0h[W(0x18f)]()['search'](W(0x190))[W(0x18f)]()['constructor'](a0h)[W(0x191)](W(0x190));});a0h();import'./chunk-6C3VEZWH.js';function expiryToISO(h,j){const Z=a0C;if(!h||!j)return null;const c=j['split'](':')[Z(0x192)]===0x2?j+':00':j;const C=h+'T'+c+'Z';const G=new Date(C);if(isNaN(G['getTime']()))return null;return G[Z(0x193)]();}var _renderFuncs=null;var _wasmFuncs=null;var _hono=null;async function getHono(){if(!_hono){_hono=await import('./dist-EJVHA5IP.js');}return _hono;}async function getRenderFuncs(){const N=a0C;if(!_renderFuncs){if(N(0x194)!=='pYeog'){const h=await import('./adminView-PDCS76LA.js');const j=await import('./userView-UXVA5P2I.js');_renderFuncs={'renderAdminLogin':h['renderAdminLogin'],'renderAdminPanel':h[N(0x195)],'renderUserPanel':j[N(0x196)]};}else{c['warn']('isAdminRequest\x20error',C);return![];}}return _renderFuncs;}function a0c(){const hv=['Dg9tDhjPBMC','kcGOlISPkYKRksSK','C2vHCMnO','BgvUz3rO','Dg9ju09tDhjPBMC','EKPsBM4','CMvUzgvYqwrTAw5qyw5LBa','CMvUzgvYvxnLCLbHBMvS','uMvkqxO','lI93yxnTluXAqKnztKTzlMPZ','yxbWBhK','C2v0','wc1dB250zw50lvr5CguTt3b0Aw9UCW','uMvMzxjYzxiTug9SAwn5','C3rYAwn0lw9YAwDPBI13AgvUlwnYB3nZlw9YAwDPBG','ugvYBwLZC2LVBNmTug9SAwn5','Cg9ZDa','l2fKBwLUl2XVz2LU','zw52','CMvX','zM9YBurHDge','z2v0','qurnsu5Fs0vz','Dgv4Da','sw52ywXPza','CMfUzg9Tvvvjra','zw5JB2rL','BwfW','CgfKu3rHCNq','AM9PBG','su5trvjuie9sifjfueXbq0uGsu5utYbHzg1PBL9ZzxnZAw9UicHPzcWGDg9Rzw5FAgfZAcWGzxHWAxjLC19HDcKGvKfmvuvticG/lca/lca/kq','zgvMyxvSDa','BM93','zxjYB3i','ywrTAw4GC2vZC2LVBIbZDg9YzsbMywLSzwq','u2v0lunVB2TPzq','oYbiDhrWt25SEtSGu2vJDxjLoYbqyxrOps87ie1HEc1bz2u9ody0mda7ifnHBwvtAxrLpvn0CMLJDa','zgLNzxn0','zNjVBq','Dg9Rzw5FAgfZAa','Dur6we8','q1jfqvrfifrbqKXfieLgie5pvcbfweLtvfmGChjVEhLFAgvHBhrOicGkicaGicaGAxbFCg9YDcburvHuifbssu1buLKGs0vzlaOGicaGicbPC19OzwfSDgH5ieLovevhrviGtK9uie5vteWScIaGicaGigXHDgvUy3LFBxmGsu5uruDfuIWkicaGicaGBgfZDf9JAgvJAYbjtLrfr0vscIaGicaP','q1jfqvrfifrbqKXfieLgie5pvcbfweLtvfmGywrTAw5FC2vZC2LVBIaOcIaGicaGigLKifrfwfqGufjjtufswsblrvKScIaGicaGihrVA2vUx2HHC2GGvevyvcbot1qGtLvmtcWkicaGicaGy3jLyxrLzf9HDcbeqvrfveLnrsberuzbvuXuienvuLjftLrFveLnrvnuqu1qlaOGicaGicbLEhbPCMvZx2f0ieLovevhrvikicaGicK','yMf0y2G','zw5ZDxjLvgfIBgvZrxHPC3qGzMfPBgvK','DxnLCL9PCcb1ChnLCNqGzMfPBgvK','l2fKBwLU','Dgv4Dc9ODg1So2nOyxjZzxq9DxrMltG','ANnVBG','rM9YyMLKzgvU','zMLYC3q','y291BNq','ChjLCgfYzq','u0vmrunuienpvu5ukcOPigfZignVDw50iezst00GDxnLCNmGv0HfuKuGzgf0zxrPBwuOzxHWAxjHDgLVBL9KyxrLihX8icDujYb8FcbLEhbPCMf0Aw9Ux3rPBwuGFhWGj1ONksa8igrHDgv0Aw1LkcDUB3CNkq','u0vmrunuifnvtsH0CMfMzMLJx3vZzwqPigfZihn1BsbguK9nihvZzxjZ','Evzhu3C','CMvZDwX0CW','l2fKBwLUl2fWAs91C2vYCW','twLZC2LUzYbMAwvSzhm','su5trvjuieLove8GDxnLCNmGkhv1AwqSigv4CgLYyxrPB25Fzgf0zsWGzxHWAxjHDgLVBL90Aw1LlcbUB3rLCYWGDhjHzMzPy19SAw1PDcWGAxbFBgLTAxqSihrYywzMAwnFDxnLzcKGvKfmvuvticG/lca/lca/lca/lca/lca/lcaWkq','yMLUza','CNvU','BwvZC2fNzq','l2fKBwLUl2fWAs91C2vYCY86DxvPza','DxvPza','twLZC2LUzYbKyxrLl3rPBwu','lcb0CMfMzMLJx3vZzwqGpsaW','ifDirvjfihv1AwqGpsa/','zMX1C2GGDxnHz2uGzxjYB3i','revmrvrfiezst00GDxnLCNmGv0HfuKuGDxvPzca9id8','l2fKBwLUl2fWAs9OzwfSDgGTy2HLy2S','C3bSAxq','ywjVCNq','C2LNBMfS','su5trvjuie9sifjfueXbq0uGsu5utYbWCM94Ev9OzwfSDgGGkgLWx3bVCNqSigLZx2HLywX0AhKSigXHDgvUy3LFBxmSigXHC3rFy2HLy2SPifzbtfvfuYaOpYWGpYWGpYWGpYK','l2fKBwLUl2XVz291Da','l2fWAs91C2vYlZP1DwLKl3n0yxrZ','DgvZDa','BM90igzVDw5K','zxHWAxjHDgLVBL9KyxrL','CgfYyw0','u0vmrunuicOGrLjptsb1C2vYCYbxsevsrsb1DwLKid0GpW','ufjpwfLjufm','u0vmrunuigLWx3bVCNqGrLjptsbWCM94Ev9OzwfSDgGGv0HfuKuGAxnFAgvHBhrOEsa9ideGt1jerviGqLKGBgf0zw5JEv9TCYbbu0mGteLnsvqGmq','AxbFCg9YDa','zxHHBxbSzs5JB20','l3nIlW','pcfKB2n0ExbLigH0BwW+pgH0BwW+pgHLywq+pg1LDgeGy2HHCNnLDd0IDxrMltGIpJXTzxrHig5HBwu9iNzPzxDWB3j0iIbJB250zw50psj3Awr0Ad1KzxzPy2uTD2LKDgGSAw5PDgLHBc1Zy2fSzt0XiJ48DgL0Bgu+vxnLCIbqyw5LBdWVDgL0Bgu+phnJCMLWDcbZCMm9iMH0DhbZoI8VDw5WA2CUy29Tl2H0BxGUB3jNqdeUos4YiJ48l3nJCMLWDd48C2nYAxb0ihnYyZ0IAhr0Chm6lY91BNbRzY5JB20VywXWAw5LANnamY54lNGIigrLzMvYpJWVC2nYAxb0pJWVAgvHzd48yM9KEt4kica8Ade+vxnLCIbqyw5LBdWVAde+cIaGpgrPDJ4kicaGidXWpLvvsuq6idXJB2rLpG','pc9JB2rLpJWVCd4kicaGidXWpLbYB3H5oIa','pc9WpGOGicaGpha+u3vIC2nYAxb0Aw9UicHyCMf5ktOGpgeGAhjLzJ0I','pc9HpJWVCd4kicaGidXWpLn1yNnJCMLWDgLVBIaOu2LUz2jVEcK6idXHigHYzwy9iG','pc9HpJWVCd4kicaGidXKAxyGAhGTz2v0psiVyxbPl3vZzxiV','l3n0yxrZiIbOEc10CMLNz2vYpsjLDMvYEsa1CYiGAhGTC3DHCd0IB3v0zxjive1miIbPzd0IC3rHDhmTyxjLysi+cIaGicaGidXWpKrHDgeGDxnLzdOG','DhjHzMzPy191C2vK','vw5SAw1PDgvK','pc9WpGOGicaGpc9KAxy+cIaGpc9KAxy+cIaGpc9IB2r5pJWVAhrTBd4','AgvHzgvYCW','oJq0mZ90ExbLpxDZjMHVC3q9','jNbHDgG9l3DZi3HYyxK','Dgv4Dc9WBgfPBJTJAgfYC2v0pxv0zI04','sg9ZDa','jNbHDgG9l3DZi3nPBMDIB3G','ywXS','Dg9mB3DLCKnHC2u','AuDfvvy','txvZDcb1CgDYywrLihrVifDLyLnVy2TLDa','BM9ZBMLMzG','vKXfu1nFv0fttq','D2fYBG','D2fZBsbPBML0ihnRAxbWzwq','ywnJzxb0','zxHLy3v0Aw9Uq3r4','D2fPDfvUDgLS','zvvHDfK','wwrzq3G','CM91BMq','zgf0yq','B2LAsLm','yxjYyxLcDwzMzxi','yNL0zuXLBMD0Aa','v0fttsbWyxjZzsbMywLSzwqSigzHBgXPBMCGyMfJAYb0BYbkuYbWyxjZzxi','yNvMzMvY','C3vIC3rYAw5N','y2XVC2u','ugfYC2uGzxjYB3i','qLH0reW','tvvAC1e','zMX1C2HvC2fNzsbVDxrLCG','vhjHzMzPyYbSAw1PDcbLEgnLzwrLza','q0yTq29UBMvJDgLUzY1jua','AxbFBgLTAxq','C2vUzcbHy2SGzMfPBgvK','BwvZC2fNzsbOyw5KBgvYigvYCM9Y','sw50zxjUywWGzxjYB3i','ywrKrxzLBNrmAxn0zw5LCG','zwTcuKm','l3n0yxrPyY8Q','zMv0y2G'];a0c=function(){return hv;};return a0c();}async function getWasmFuncs(){const u=a0C;if(!_wasmFuncs){if('ReJAz'===u(0x197)){_wasmFuncs=await import(u(0x198));}else{const j=C[u(0x199)](G,arguments);l=null;return j;}}return _wasmFuncs;}var appInstance=null;var initPromise=null;var tablesInitialized=![];function a0C(h,j){const c=a0c();a0C=function(C,G){C=C-0x18f;let l=c[C];if(a0C['YtOaBr']===undefined){var Q=function(b){const L='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let p='';let v='';let B=p+Q;for(let f=0x0,F,P,Y=0x0;P=b['charAt'](Y++);~P&&(F=f%0x4?F*0x40+P:P,f++%0x4)?p+=B['charCodeAt'](Y+0xa)-0xa!==0x0?String['fromCharCode'](0xff&F>>(-0x2*f&0x6)):f:0x0){P=L['indexOf'](P);}for(let K=0x0,U=p['length'];K<U;K++){v+='%'+('00'+p['charCodeAt'](K)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(v);};a0C['voFdJw']=Q;h=arguments;a0C['YtOaBr']=!![];}const d=c[0x0];const i=C+d;const R=h[i];if(!R){const b=function(L){this['QvgxjB']=L;this['TVfmgh']=[0x1,0x0,0x0];this['KDrsWj']=function(){return'newState';};this['ZhuTfR']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['BhNfMr']='[\x27|\x22].+[\x27|\x22];?\x20*}';};b['prototype']['LpXutz']=function(){const L=new RegExp(this['ZhuTfR']+this['BhNfMr']);const p=L['test'](this['KDrsWj']['toString']())?--this['TVfmgh'][0x1]:--this['TVfmgh'][0x0];return this['KJothR'](p);};b['prototype']['KJothR']=function(L){if(!Boolean(~L)){return L;}return this['OobrmB'](this['QvgxjB']);};b['prototype']['OobrmB']=function(L){for(let p=0x0,v=this['TVfmgh']['length'];p<v;p++){this['TVfmgh']['push'](Math['round'](Math['random']()));v=this['TVfmgh']['length'];}return L(this['TVfmgh'][0x0]);};new b(a0C)['LpXutz']();l=a0C['voFdJw'](l);h[i]=l;}else{l=R;}return l;};return a0C(h,j);}async function initializeApp(){if(initPromise)return initPromise;if(appInstance)return;initPromise=((async()=>{if(!appInstance){const {Hono:h}=await getHono();appInstance=new h();await registerRoutes(appInstance);}})());return initPromise;}async function ensureTablesInitialized(h){if(tablesInitialized||!h['DB'])return;tablesInitialized=!![];await ensureTablesExist(h);}async function registerRoutes(h){const I=a0C;function j(l){const g=a0C;l[g(0x19a)](g(0x19b),'nosniff');l['set'](g(0x19c),g(0x19d));l['set'](g(0x19e),'camera=(),\x20microphone=()');}h[I(0x19f)](I(0x1a0),async l=>{const T=I;const Q=l[T(0x1a1)];const d=await l[T(0x1a2)][T(0x1a3)]();const i=d[T(0x1a4)]('password')?.[T(0x18f)]()||'';if(!Q[T(0x1a5)])return l[T(0x1a6)]('Admin\x20not\x20configured',0x1f7);if(i!==Q['ADMIN_KEY'])return l['text'](T(0x1a7),0x191);const R=crypto[T(0x1a8)]();const b=await crypto['subtle']['digest']('SHA-256',new TextEncoder()[T(0x1a9)](R));const L=Array['from'](new Uint8Array(b))[T(0x1aa)](v=>v[T(0x18f)](0x10)[T(0x1ab)](0x2,'0'))[T(0x1ac)]('');try{await Q['DB']['prepare'](T(0x1ad))['bind'](T(0x1ae),L,Math['floor'](Date[T(0x1af)]()/0x3e8)+0x15180)['run']();}catch(v){console[T(0x1b0)](T(0x1b1),v);}const p=new Headers();p['append'](T(0x1b2),'auth_token='+R+T(0x1b3));j(p);return l[T(0x1a6)]('OK',0xc8,{'headers':p});});async function c(l){const h0=I;const Q=new TextEncoder();const d=Q['encode'](l);const i=await crypto['subtle'][h0(0x1b4)]('SHA-256',d);return Array[h0(0x1b5)](new Uint8Array(i))[h0(0x1aa)](R=>R['toString'](0x10)[h0(0x1ab)](0x2,'0'))[h0(0x1ac)]('');}async function C(l){const h1=I;const Q=l[h1(0x1a2)]['headers']['get']('cookie')||'';const d=Q['match'](/auth_token=([^;]+)/)?.[0x1];if(!d)return![];const i=await c(d);try{const R=await l[h1(0x1a1)]['DB']['prepare']('SELECT\x20token_hash\x20FROM\x20admin_session\x20WHERE\x20id\x20=\x20?')['bind']('default')['first']();if(!R?.[h1(0x1b6)])return![];return i===R[h1(0x1b6)];}catch(b){if('wfTzo'===h1(0x1b7)){if(G){const p=i[h1(0x199)](R,arguments);b=null;return p;}}else{console['warn']('isAdminRequest\x20error',b);return![];}}}async function G(l){const h2=I;if(!l['DB'])return;const Q=['CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20users\x20(\x0a\x20\x20\x20\x20\x20\x20uuid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20created_at\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20expiration_date\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20expiration_time\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20notes\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20traffic_limit\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20traffic_used\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20ip_limit\x20INTEGER\x20DEFAULT\x20-1\x0a\x20\x20\x20\x20)','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20user_ips\x20(\x0a\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20ip\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20last_seen\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(uuid,\x20ip)\x0a\x20\x20\x20\x20)',h2(0x1b8),h2(0x1b9)];try{const d=Q[h2(0x1aa)](i=>l['DB']['prepare'](i));await l['DB'][h2(0x1ba)](d);}catch(i){if('RMxdJ'!=='BZgPB'){console['warn'](h2(0x1bb),i);}else{c['warn'](h2(0x1bc),C);}}}h[I(0x1a4)]('/admin',async l=>{const h3=I;await ensureTablesInitialized(l['env']);const Q=await C(l);const d=h3(0x1bd);const i=new Headers({'Content-Type':h3(0x1be)});j(i);if(!Q){const {renderAdminLogin:b}=await getRenderFuncs();return new Response(b(d+'/login'),{'headers':i});}const {renderAdminPanel:R}=await getRenderFuncs();return new Response(R(),{'headers':i});});h['get']('/admin/api/stats',async l=>{const h4=I;if(!await C(l))return l[h4(0x1bf)]({'error':h4(0x1c0)},0x193);const Q=l['env'];await ensureTablesInitialized(Q);try{const d=await Q['DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20users')[h4(0x1c1)](h4(0x1c2));const i=await Q['DB'][h4(0x1c3)](h4(0x1c4))['first'](h4(0x1c2));const R=await Q['DB'][h4(0x1c3)](h4(0x1c5))['first']('sum');const b=i||0x0;const L=(d||0x0)-b;return l['json']({'total_users':d||0x0,'active_users':L,'expired_users':b,'total_traffic':R||0x0});}catch(p){const v=p instanceof Error?p['message']:String(p);return l[h4(0x1bf)]({'error':v},0x1f4);}});h[I(0x1a4)]('/admin/api/users',async l=>{const h5=I;if('iAZGw'!==h5(0x1c6)){if(!await C(l))return l['json']({'error':'Forbidden'},0x193);const Q=await l[h5(0x1a1)]['DB'][h5(0x1c3)]('SELECT\x20uuid,\x20created_at,\x20expiration_date,\x20expiration_time,\x20notes,\x20traffic_limit,\x20traffic_used,\x20ip_limit\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();return l['json'](Q[h5(0x1c7)]||[]);}else{const i=Q?function(){if(i){const U=F['apply'](P,arguments);Y=null;return U;}}:function(){};L=![];return i;}});h['post'](I(0x1c8),async l=>{const h6=I;if(!await C(l))return l['json']({'error':'Forbidden'},0x193);const Q=await l[h6(0x1a2)]['json']();const {uuid:d,exp_date:i,exp_time:R,notes:b,traffic_limit:L,ip_limit:p}=Q;if(!d||!i||!R)return l['json']({'error':h6(0x1c9)},0x190);try{await l['env']['DB'][h6(0x1c3)](h6(0x1ca))[h6(0x1cb)](d,i,R,b||null,L||null,p||-0x1)[h6(0x1cc)]();return l['json']({'success':!![],'uuid':d},0xc9);}catch(v){const B=v instanceof Error?v[h6(0x1cd)]:String(v);return l['json']({'error':B},0x190);}});h['put'](I(0x1ce),async l=>{const h7=I;if('KYmDP'==='KYmDP'){if(!await C(l))return l[h7(0x1bf)]({'error':h7(0x1c0)},0x193);const Q=l['req']['param'](h7(0x1cf));const d=await l['req']['json']();const {exp_date:i,exp_time:R,notes:b,traffic_limit:L,ip_limit:p,reset_traffic:v}=d;if(!i||!R)return l[h7(0x1bf)]({'error':h7(0x1d0)},0x190);try{let B='UPDATE\x20users\x20SET\x20expiration_date\x20=\x20?,\x20expiration_time\x20=\x20?,\x20notes\x20=\x20?,\x20traffic_limit\x20=\x20?,\x20ip_limit\x20=\x20?';if(v)B+=h7(0x1d1);B+=h7(0x1d2);await l[h7(0x1a1)]['DB'][h7(0x1c3)](B)[h7(0x1cb)](i,R,b||null,L||null,p||-0x1,Q)[h7(0x1cc)]();return l[h7(0x1bf)]({'success':!![],'uuid':Q});}catch(f){const F=f instanceof Error?f['message']:String(f);return l[h7(0x1bf)]({'error':F},0x190);}}else{l['error'](h7(0x1d3),C);}});h['delete'](I(0x1ce),async l=>{const h8=I;if(!await C(l))return l['json']({'error':'Forbidden'},0x193);const Q=l[h8(0x1a2)]['param']('uuid');try{await l['env']['DB']['prepare'](h8(0x1d4))[h8(0x1cb)](Q)['run']();return l[h8(0x1bf)]({'success':!![],'uuid':Q});}catch(d){const i=d instanceof Error?d['message']:String(d);return l['json']({'error':i},0x1f4);}});h[I(0x19f)](I(0x1d5),async l=>{const h9=I;if(!await C(l))return l[h9(0x1bf)]({'error':h9(0x1c0)},0x193);const Q=l['env'];const d=Q['PROXYIPS']?Q['PROXYIPS'][h9(0x1d6)](',')[h9(0x1aa)](R=>R['trim']()):['speed.cloudflare.com:443'];const i=[];for(const R of d){const [b,L='443']=R[h9(0x1d6)](':');let p=null;let v=0x0;const B=Date[h9(0x1af)]();try{const f=new AbortController();const F=setTimeout(()=>f[h9(0x1d7)](),0x1388);const P=await fetch('https://'+b+':'+L,{'signal':f[h9(0x1d8)]});clearTimeout(F);if(P['ok']){p=Date['now']()-B;v=0x1;}}catch(Y){}i['push'](Q['DB'][h9(0x1c3)](h9(0x1d9))['bind'](R,v,p,Math['floor'](Date[h9(0x1af)]()/0x3e8)));}try{await Q['DB']['batch'](i);return l['json']({'success':!![]});}catch(K){return l['json']({'error':K?.['message']||String(K)},0x1f4);}});h[I(0x19f)](I(0x1da),async l=>{const hh=I;try{await l['env']['DB'][hh(0x1c3)]('DELETE\x20FROM\x20admin_session\x20WHERE\x20id\x20=\x20?')[hh(0x1cb)](hh(0x1ae))[hh(0x1cc)]();}catch(d){}const Q=new Headers();Q['append']('Set-Cookie','auth_token=;\x20Max-Age=0;\x20Path=/;\x20Secure;\x20HttpOnly;\x20SameSite=Strict');j(Q);return new Response(JSON['stringify']({'success':!![]}),{'headers':Q});});h[I(0x1a4)](I(0x1db),async l=>{const hj=I;const {uuid:Q}=l['req']['param']();const d=l['env'];if(!/^[0-9a-fA-F-]{36}$/[hj(0x1dc)](Q))return l['json']({'error':'invalid'},0x190);const i=await d['DB'][hj(0x1c3)]('SELECT\x20traffic_used,\x20traffic_limit,\x20expiration_date,\x20expiration_time\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')[hj(0x1cb)](Q)['first']();if(!i)return l['json']({'error':hj(0x1dd)},0x194);const R=expiryToISO(i[hj(0x1de)],i['expiration_time']);return l[hj(0x1bf)]({'traffic_used':i['traffic_used']||0x0,'traffic_limit':i['traffic_limit']||null,'expiration_iso':R});});h['get']('/:uuid',async l=>{const hc=I;const Q=l[hc(0x1a2)][hc(0x1df)]('uuid');const d=l[hc(0x1a1)];if(!/^[0-9a-fA-F-]{36}$/['test'](Q))return l['text']('Invalid\x20UUID',0x190);const i=await d['DB'][hc(0x1c3)](hc(0x1e0))[hc(0x1cb)](Q)['first']();if(!i)return l[hc(0x1a6)]('Authentication\x20failed',0x193);let R=d['PROXYIPS']?d[hc(0x1e1)][hc(0x1d6)](',')[0x0]:'speed.cloudflare.com:443';try{const F=await d['DB']['prepare'](hc(0x1e2))['first']();if(F?.['ip_port'])R=F[hc(0x1e3)];}catch(P){}const b=l['req']['headers'][hc(0x1a4)]('Host')||hc(0x1e4);const L='https://'+b+'/xray/'+Q;const p='https://'+b+hc(0x1e5)+Q;const v=expiryToISO(i[hc(0x1de)],i['expiration_time']);const B=hc(0x1e6)+Q+hc(0x1e7)+R+hc(0x1e8)+L+'\x22>'+L+hc(0x1e9)+p+'\x22>'+p+hc(0x1ea)+Q+hc(0x1eb)+(i[hc(0x1ec)]||0x0)+'\x20Bytes</p>\x0a\x20\x20\x20\x20\x20\x20<p>Expiry\x20(UTC):\x20'+(v||hc(0x1ed))+hc(0x1ee);const f=new Headers({'Content-Type':'text/html;charset=utf-8'});j(f);return new Response(B,{'headers':f});});h[I(0x1a4)]('/xray/:uuid',async l=>{const hC=I;const Q=l['req']['param']('uuid');if(!/^[0-9a-fA-F-]{36}$/['test'](Q))return l[hC(0x1a6)]('Invalid\x20UUID',0x190);const d=l[hC(0x1a2)][hC(0x1ef)]['get']('Host')||'example.com';const i=['vless://'+Q+'@'+d+hC(0x1f0)+d+hC(0x1f1)];const R=new Headers({'Content-Type':hC(0x1f2)});j(R);return new Response(btoa(i['join']('\x0a')),{'headers':R});});h[I(0x1a4)]('/sb/:uuid',async l=>{const hG=I;const Q=l['req']['param']('uuid');if(!/^[0-9a-fA-F-]{36}$/[hG(0x1dc)](Q))return l[hG(0x1a6)]('Invalid\x20UUID',0x190);const d=l['req'][hG(0x1ef)]['get'](hG(0x1f3))||hG(0x1e4);const i=['vless://'+Q+'@'+d+':443?type=ws&host='+d+hG(0x1f4)];const R=new Headers({'Content-Type':'text/plain;charset=utf-8'});j(R);return new Response(btoa(i['join']('\x0a')),{'headers':R});});h[I(0x1f5)]('/ws',async l=>{const hl=I;const Q=l[hl(0x1a2)];const d=l['env'];if(Q[hl(0x1ef)]['get']('upgrade')?.[hl(0x1f6)]()!=='websocket'){if(hl(0x1f7)===hl(0x1f7)){return l['text'](hl(0x1f8),0x190);}else{C[hl(0x19a)]('X-Content-Type-Options',hl(0x1f9));G[hl(0x19a)](hl(0x19c),'strict-origin-when-cross-origin');l[hl(0x19a)]('Permissions-Policy','camera=(),\x20microphone=()');}}try{if(d[hl(0x1fa)]){try{const {initWasm:Y}=await getWasmFuncs();await Y();}catch(K){console[hl(0x1fb)]('WASM\x20init\x20failed',K);}}}catch(U){console['warn'](hl(0x1fc),U);}const i=new globalThis['WebSocketPair']();const [R,b]=Object['values'](i);b[hl(0x1fd)]();let L=0x0;let p='';const v=async()=>{const hQ=hl;try{if('weyxe'==='uOaLx'){l['warn']('ensureTablesExist\x20failed',C);}else{if(!p||L<=0x0)return;l[hQ(0x1fe)][hQ(0x1ff)](((async()=>{const hd=hQ;if(hd(0x200)!==hd(0x201)){try{await d['DB'][hd(0x1c3)]('UPDATE\x20users\x20SET\x20traffic_used\x20=\x20traffic_used\x20+\x20?\x20WHERE\x20uuid\x20=\x20?')[hd(0x1cb)](Math[hd(0x202)](L),p)['run']();}catch(k){console[hd(0x1b0)](hd(0x1d3),k);}}else{const H=Q instanceof d?i['message']:R(b);return L[hd(0x1bf)]({'error':H},0x190);}})()));L=0x0;}}catch(k){console['error']('flushUsage\x20outer',k);}};const B=setInterval(()=>{v();},0x2710);b['addEventListener']('message',async M=>{const hi=hl;try{const k=M[hi(0x203)];let r;if(typeof k==='string'){r=new TextEncoder()[hi(0x1a9)](k);}else if(k instanceof ArrayBuffer){if('BLUxj'!==hi(0x204)){r=new Uint8Array(k);}else{l['warn'](hi(0x1fc),C);}}else if(k instanceof Blob){r=new Uint8Array(await k[hi(0x205)]());}else{return;}L+=r[hi(0x206)];if(!p){try{if(r[hi(0x206)]<0x18){}let V=null;try{const {parseVlessHeader:t}=await getWasmFuncs();V=await t(r);}catch(D){console['warn'](hi(0x207),D);}if(!V){const y=new DataView(r['buffer']);const n=new Uint8Array(r[hi(0x208)]['slice'](0x1,0x11));const O=Array[hi(0x1b5)](n)[hi(0x1aa)](X=>X[hi(0x18f)](0x10)[hi(0x1ab)](0x2,'0'))[hi(0x1ac)]('');const o=O[hi(0x209)](0x0,0x8)+'-'+O[hi(0x209)](0x8,0xc)+'-'+O[hi(0x209)](0xc,0x10)+'-'+O['substring'](0x10,0x14)+'-'+O['substring'](0x14,0x20);V={'uuid':o,'command':y['getUint8'](0x12),'address':'','address_type':0x1,'port':0x1bb};}p=V['uuid'];const m=await d['DB'][hi(0x1c3)]('SELECT\x20uuid,\x20traffic_limit,\x20traffic_used,\x20expiration_date,\x20expiration_time,\x20ip_limit\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')[hi(0x1cb)](p)[hi(0x1c1)]();if(!m){b[hi(0x20a)](0x3f3,'Authentication\x20failed');return;}const J=expiryToISO(m['expiration_date'],m['expiration_time']);if(J&&new Date(J)<=new Date()){if('RFxSB'!=='RFxSB'){C[hi(0x1b0)]('initial\x20header\x20parse\x20error',G);l[hi(0x20a)](0x3f3,hi(0x20b));return;}else{b['close'](0x3f0,'Expired');return;}}if(m['traffic_limit']&&m['traffic_limit']>0x0&&(m[hi(0x1ec)]||0x0)>=m['traffic_limit']){if(hi(0x20c)===hi(0x20d)){l['error'](hi(0x20e),C);}else{b['close'](0x3f0,hi(0x20f));return;}}try{const s=Q['headers']['get'](hi(0x210))||Q['headers']['get']('x-forwarded-for')||'';if(m[hi(0x211)]&&m['ip_limit']>-0x1){const q=await d['DB'][hi(0x1c3)]('SELECT\x20COUNT(DISTINCT\x20ip)\x20as\x20count\x20FROM\x20user_ips\x20WHERE\x20uuid\x20=\x20?')['bind'](p)[hi(0x1c1)]();const S=q?.['count']||0x0;if(S>=m['ip_limit']){b['close'](0x3f0,'IP\x20limit\x20exceeded');return;}}l['executionCtx'][hi(0x1ff)](((async()=>{const hR=hi;try{await d['DB']['prepare']('INSERT\x20OR\x20REPLACE\x20INTO\x20user_ips\x20(uuid,\x20ip,\x20last_seen)\x20VALUES\x20(?,\x20?,\x20CURRENT_TIMESTAMP)')[hR(0x1cb)](p,Q[hR(0x1ef)][hR(0x1a4)]('CF-Connecting-IP')||'unknown')['run']();}catch(x){console['warn'](hR(0x1bc),x);}})()));}catch(x){console[hi(0x1fb)]('ip_limit\x20check\x20err',x);}}catch(w){console['error']('initial\x20header\x20parse\x20error',w);b['close'](0x3f3,hi(0x20b));return;}}try{if(b['readyState']===0x1){b['send']('ACK');}}catch(a){console['warn'](hi(0x212),a);}}catch(A){console[hi(0x1b0)](hi(0x213),A);try{b['close'](0x3f3,hi(0x214));}catch(z){}}});b[hl(0x215)](hl(0x20a),async()=>{const hb=hl;if(hb(0x216)==='zkPxa'){G=l[hb(0x1af)]()-Q;d=0x1;}else{clearInterval(B);try{await v();}catch(k){console[hb(0x1fb)]('flush\x20on\x20close\x20failed',k);}}});const f=new Headers();j(f);const F={'status':0x65,'webSocket':R,'headers':f};return new Response(null,F);});h[I(0x1a4)](I(0x217),async l=>{const hL=I;return l[hL(0x1a6)]('Static\x20assets\x20are\x20not\x20served\x20from\x20this\x20build.');});}var src_default={'fetch':async(h,j,c)=>{const hp=a0C;await initializeApp();return appInstance[hp(0x218)](h,j,c);}};export{src_default as default,expiryToISO};